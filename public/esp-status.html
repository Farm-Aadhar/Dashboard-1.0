<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ESP Connection Status</title>
    <meta http-equiv="Content-Type" content="application/json; charset=UTF-8">
</head>
<body>
<script>
// Get ESP connection status from localStorage
function getESPConnectionStatus() {
    try {
        const enabled = localStorage.getItem('esp_connection_enabled');
        const collectionMode = localStorage.getItem('data_collection_mode') || 'stopped';
        const isEnabled = enabled ? JSON.parse(enabled) : false;
        
        const messages = {
            stopped: "Data collection stopped - ESP nodes should not send data to database",
            collecting: "Data collection active - ESP nodes should send data to database", 
            continuous: "Continuous data collection - ESP nodes should continuously send data to database"
        };
        
        return {
            esp_connection_enabled: isEnabled,
            data_collection_enabled: collectionMode !== 'stopped',
            collection_mode: collectionMode,
            timestamp: new Date().toISOString(),
            message: messages[collectionMode] || messages.stopped
        };
    } catch (error) {
        return {
            esp_connection_enabled: false,
            data_collection_enabled: false,
            collection_mode: "stopped",
            timestamp: new Date().toISOString(),
            message: "Data collection stopped - ESP nodes should not send data to database (default)"
        };
    }
}

// Set content type and return JSON
document.addEventListener('DOMContentLoaded', function() {
    const status = getESPConnectionStatus();
    document.body.innerHTML = '<pre>' + JSON.stringify(status, null, 2) + '</pre>';
    document.body.style.fontFamily = 'monospace';
    document.body.style.margin = '0';
    document.body.style.padding = '10px';
    document.body.style.backgroundColor = '#f5f5f5';
});

// For ESP nodes to access directly
window.getESPConnectionStatus = getESPConnectionStatus;

// Also expose as JSON for direct access
const status = getESPConnectionStatus();
console.log('ESP Connection Status:', status);
</script>
</body>
</html>
