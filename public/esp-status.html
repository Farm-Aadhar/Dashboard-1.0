<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ESP Connection Status</title>
    <meta http-equiv="Content-Type" content="application/json; charset=UTF-8">
</head>
<body>
<script>
// Get ESP connection status from localStorage
function getESPConnectionStatus() {
    try {
        const enabled = localStorage.getItem('esp_connection_enabled');
        const isEnabled = enabled ? JSON.parse(enabled) : true;
        
        return {
            esp_connection_enabled: isEnabled,
            timestamp: new Date().toISOString(),
            message: isEnabled 
                ? "ESP nodes are allowed to send data" 
                : "ESP nodes should stop sending data"
        };
    } catch (error) {
        return {
            esp_connection_enabled: true,
            timestamp: new Date().toISOString(),
            message: "ESP nodes are allowed to send data (default)"
        };
    }
}

// Set content type and return JSON
document.addEventListener('DOMContentLoaded', function() {
    const status = getESPConnectionStatus();
    document.body.innerHTML = '<pre>' + JSON.stringify(status, null, 2) + '</pre>';
    document.body.style.fontFamily = 'monospace';
    document.body.style.margin = '0';
    document.body.style.padding = '10px';
    document.body.style.backgroundColor = '#f5f5f5';
});

// For ESP nodes to access directly
window.getESPConnectionStatus = getESPConnectionStatus;

// Also expose as JSON for direct access
const status = getESPConnectionStatus();
console.log('ESP Connection Status:', status);
</script>
</body>
</html>
